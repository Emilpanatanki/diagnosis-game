<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guess the Diagnosis...ü§î</title>
  <style>
    :root{
      --bg:#f7faff; --panel:#ffffff; --ink:#0b1220; --muted:#4b5565;
      --green:#15a377; --orange:#b7791f; --red:#d64545; --accent:#2563eb;
      --chip:#f3f6fb; --chip-b:#e5eaf3; --border:#e6e9f2;
    }
    html,body{background:var(--bg); color:var(--ink); font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin:0}
    .wrap{max-width:1100px; margin:24px auto; padding:0 16px}
    h1{font-size:24px; margin:0 0 12px}
    .card{background:var(--panel); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow:0 6px 18px rgba(10,20,60,.05)}
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .row > *{flex:1}
    label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    input[type="text"]{width:100%; background:#ffffff; color:var(--ink); border:1px solid #dce1eb; border-radius:10px; padding:10px 12px}
    button{background:var(--accent); color:#ffffff; border:0; border-radius:12px; padding:10px 14px; font-weight:600; cursor:pointer}
    button.ghost{background:transparent; color:var(--ink); border:1px solid var(--border)}
    button:disabled{opacity:.5; cursor:not-allowed}
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{background:var(--chip); border:1px solid var(--chip-b); padding:6px 10px; border-radius:999px; font-size:12px; display:inline-block; margin:12px 10px 12px 0}
    table{width:100%; border-collapse:separate; border-spacing:0; margin-top:12px}
    thead th{position:sticky; top:0; background:#f4f7ff; z-index:2}
    th, td{border-bottom:1px solid var(--border); padding:10px; text-align:left; vertical-align:top; font-size:14px}
    tbody tr:hover{background:#f9fbff}
    .cell{border-radius:8px; padding:6px 8px; display:inline-block}
    .green{background:rgba(21,163,119,.12); outline:1px solid rgba(21,163,119,.35)}
    .orange{background:rgba(183,121,31,.12); outline:1px solid rgba(183,121,31,.35)}
    .red{background:rgba(214,69,69,.12); outline:1px solid rgba(214,69,69,.35)}
    .score{font-weight:700}
    .legend{display:flex; gap:12px; align-items:center; color:var(--muted); font-size:13px}
    .swatch{width:14px; height:14px; border-radius:4px; display:inline-block; margin-right:6px}
    .swatch.g{background:var(--green)} .swatch.o{background:var(--orange)} .swatch.r{background:var(--red)}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .colwrap{overflow:auto}
    .rightShift{ margin-left: 8px }
    .toggle-btn{ background:transparent; color:var(--ink); border:1px solid var(--border); border-radius:12px; padding:8px 12px; font-weight:600; display:inline-flex; align-items:center; gap:8px }
    .toggle-btn:hover{ background:#f0f3fa }
    .toggle-icon{ display:inline-block }
    .instructions-panel{ display:none }
    .instructions-panel.is-open{ display:block }
    .confetti{ position:fixed; inset:0; pointer-events:none; z-index:0 }
    .confetti .bit{ position:absolute; font-size:96px; opacity:.14; user-select:none; line-height:1; filter:saturate(115%); transform:translate(-50%,-50%) }
  </style>
</head>
<body>
  <div class="confetti" id="organConfetti" aria-hidden="true"></div>
  <div class="wrap">
    <h1>Guess the Diagnosis...ü§î</h1>
    <div class="card" style="margin-top:12px">
      <div class="row" style="align-items:center; justify-content:space-between">
        <div style="flex:1 1 auto">
          <button id="toggleInstructions" class="toggle-btn" aria-expanded="false" aria-controls="instructionsPanel">Show Instructions <span class="toggle-icon" aria-hidden="true">‚ñº</span></button>
        </div>
      </div>
      <div id="instructionsPanel" class="instructions-panel" hidden>
        <div class="small muted" style="margin:12px 0 0 0">
          <p><em>(Like Wordle, but with stethoscopes!)</em></p>
          <p><strong>Welcome to "Guess the Diagnosis"</strong> ‚Äî your daily dose of diagnostic fun! Your mission: crack the mystery diagnosis using your brain, your gut, and a little bit of luck.</p>
          <p><strong>1Ô∏è‚É£ Make Your First Guess</strong><br>Think of any diagnosis that might fit the case. Type it in and click <strong>Add Diagnosis</strong>.</p>
          <p><strong>2Ô∏è‚É£ Read the Color Clues</strong><br>Each column compares your guess with the hidden diagnosis:</p>
          <ul style="margin:6px 0 0 18px; padding:0">
            <li><em>System ü´Äü´Å</em>: Which organ system is affected?</li>
            <li><em>Age üë∂üë©‚Äçü¶≥</em>: What‚Äôs the typical patient age?</li>
            <li><em>Epidemiology üåç</em>: Who usually gets it?</li>
            <li><em>(Plus other juicy medical details)</em></li>
          </ul>
          <p>Colors tell the story:<br>üü© <strong>Green</strong> = Bingo! Exact or very close match.<br>üüß <strong>Orange</strong> = You‚Äôre warm‚Äîpartially similar.<br>üü• <strong>Red</strong> = Nope‚Äîcompletely different.</p>
          <p><strong>3Ô∏è‚É£ Refine Your Guess</strong><br>Use the color clues to adjust your thinking.<br><em>Example:</em> If the system is green but age is red, guess another diagnosis of the same system but with a different patient profile.</p>
          <p><strong>4Ô∏è‚É£ Win Like a Pro</strong><br>Aim to get all columns green as fast as possible! Or keep guessing until you hit the right combo.</p>
          <p><strong>5Ô∏è‚É£ Start Fresh Anytime</strong><br>Click <strong>Reset Diagnosis</strong> for a brand-new random case whenever you‚Äôre ready for the next challenge.</p>
          <p><strong>üí° Pro Tip:</strong> The best players mix solid medical reasoning with wild guesses. Sometimes, the weird one is the winner.<br>Now scrub in, doctor‚Äîyour patient awaits! ü©∫</p>
        </div>
      </div>
    </div>
    <div class="card" style="margin-top:16px">
      <div class="row">
        <div>
          <label>Your Guess</label>
          <input id="guess" list="diagnosisList" type="text" placeholder="Start typing‚Ä¶" />
          <datalist id="diagnosisList"></datalist>
        </div>
        <div style="align-self:end; display:flex; gap:8px">
          <button id="guessBtn" class="rightShift">Add Diagnosis</button>
          <button id="resetBtn" class="ghost rightShift">Reset Diagnosis</button>
        </div>
      </div>
      <div class="legend" style="margin-top:10px">
        <span><span class="swatch g"></span>Green = exact/very close</span>
        <span><span class="swatch o"></span>Orange = partially similar</span>
        <span><span class="swatch r"></span>Red = different</span>
      </div>
      <div class="colwrap">
        <table id="table">
          <thead>
            <tr>
              <th>Guess</th>
              <th>System</th>
              <th>Age group</th>
              <th>Epidemiology</th>
              <th>Etiology</th>
              <th>Key findings</th>
              <th>Management</th>
              <th>Course</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <p class="small muted" style="margin-top:10px">Educational use only. Not medical advice.</p>
  </div>
  <script>
    
    const CSV_30 = `Diagnosis,Aliases,System,AgeGroup,Epidemiology,Etiology,Onset,KeyFindings,Investigation,Management,SeverityRisk
Myocardial Infarction,Heart attack; MI,Cardiovascular,Adults/Elderly,Common in males >50,Vascular,Acute,Chest pain; sweating,ECG; Troponin,Mixed,High
Pneumonia,Lower respiratory tract infection,Respiratory,All ages,Common in elderly,Infection,Acute,Fever; cough,Chest X-ray,Medication,Moderate
Asthma,Bronchial asthma,Respiratory,Children/Young Adults,Affects 5-10% population,Unknown,Acute/Recurrent,Wheeze; dyspnea,Spirometry,Mixed,Low
Stroke,Cerebrovascular accident; CVA,Neurological,Adults/Elderly,Common in hypertensives,Vascular,Acute,Sudden weakness; facial droop,CT/MRI brain,Mixed,High
Appendicitis,,Gastrointestinal,Teens/Young Adults,Common surgical emergency,Unknown,Acute,RLQ pain; fever,Clinical + Ultrasound,Surgery,Moderate
Diabetic Ketoacidosis,DKA,Endocrine,Young adults,Occurs in poorly controlled diabetics,Metabolic,Acute,Polyuria; dehydration,Blood glucose; ketones,Mixed,High
Cholelithiasis,Gallstones,Gastrointestinal,Adults,More common in females,Unknown,Variable,RUQ pain; nausea after fatty meals,Ultrasound,Surgery,Low
Tuberculosis,TB,Infectious Disease,All ages,Common in developing countries,Infection,Chronic,Cough; night sweats,Sputum smear; CXR,Medication,Moderate
Hypertension,High blood pressure,Cardiovascular,Adults/Elderly,Affects ~30% adults,Genetic,Chronic,Often asymptomatic; headaches,BP measurement,Mixed,Moderate
Chronic Obstructive Pulmonary Disease,COPD,Respiratory,Adults/Elderly,Common in smokers,Inflammation,Chronic,Dyspnea; chronic cough,Spirometry,Medication,Moderate
Gastroesophageal Reflux Disease,GERD,Gastrointestinal,Adults,Affects ~20% population,Unknown,Chronic,Heartburn; regurgitation,pH monitoring; endoscopy,Mixed,Low
Migraine,,Neurological,Young Adults,Affects ~15% population,Unknown,Recurrent,Throbbing headache; photophobia,Clinical,Mixed,Low
Depression,Major depressive disorder,Psychiatric,All ages,Affects ~5-10% population,Genetic,Chronic/Episodic,Low mood; anhedonia,Clinical,Medication,Moderate
Anxiety Disorder,Generalized anxiety disorder,Psychiatric,All ages,Affects ~10% population,Unknown,Chronic,Restlessness; insomnia,Clinical,Medication,Low
Bipolar Disorder,Manic depression,Psychiatric,Young Adults,Affects ~1-2% population,Unknown,Episodic,Mood swings; mania,Clinical,Medication,Moderate
Peptic Ulcer Disease,PUD,Gastrointestinal,Adults,Common in NSAID users,Unknown,Chronic/Recurrent,Epigastric pain; nausea,Endoscopy,Mixed,Low
Viral Hepatitis B,Hep B,Infectious Disease,All ages,High prevalence in Asia/Africa,Infection,Acute/Chronic,Jaundice; fatigue,HBsAg testing,Supportive care,Moderate
Viral Hepatitis C,Hep C,Infectious Disease,Adults,Common in IVDU,Infection,Chronic,Often asymptomatic; fatigue,HCV antibody test,Medication,Moderate
HIV/AIDS,Human immunodeficiency virus infection,Infectious Disease,Adults,Worldwide,Infection,Chronic,Weight loss; opportunistic infections,HIV antibody test,Mixed,High
Sepsis,Septicemia,Infectious Disease,All ages,Common in ICU patients,Infection,Acute,Fever; hypotension,Blood cultures,Medication,High
Urinary Tract Infection,UTI,Genitourinary,All ages,Common in women,Infection,Acute,Dysuria; frequency,Urinalysis; urine culture,Medication,Low
Pyelonephritis,,Genitourinary,All ages,More common in women,Infection,Acute,Fever; flank pain,Urinalysis; urine culture,Medication,Moderate
Nephrolithiasis,Kidney stones,Genitourinary,Adults,More common in males,Unknown,Acute/Recurrent,Flank pain; hematuria,Non-contrast CT,Supportive care,Moderate
Chronic Kidney Disease,CKD,Genitourinary,Adults/Elderly,Common in diabetics,Unknown,Chronic,Fatigue; edema,eGFR; creatinine,Mixed,High
Otitis Media,,ENT,Children,Common in infants & toddlers,Infection,Acute,Ear pain; fever,Otoscopy,Medication,Low
Otitis Externa,Swimmer's ear,ENT,All ages,Common in swimmers,Infection,Acute,Ear pain; discharge,Otoscopy,Medication,Low
Sinusitis,Rhinosinusitis,ENT,All ages,Common after URTI,Inflammation,Acute,Facial pain; nasal congestion,Clinical,Medication,Low
Tonsillitis,Pharyngitis,ENT,Children/Young Adults,Common in winter,Infection,Acute,Sore throat; fever,Throat swab,Medication,Low
Conjunctivitis,Pink eye,Ophthalmology,All ages,Highly contagious,Unknown,Acute,Red eye; discharge,Clinical,Medication,Low
Glaucoma,,Ophthalmology,Adults/Elderly,Common cause of blindness,Unknown,Chronic,Peripheral vision loss,Tonometry,Medication,Moderate
Cataract,,Ophthalmology,Elderly,Leading cause of blindness,Unknown,Chronic,Blurred vision,Slit-lamp exam,Mixed,Low
Retinal Detachment,,Ophthalmology,Adults/Elderly,More common in myopes,Unknown,Acute,Flashes; floaters,Fundoscopy,Surgery,High
Epilepsy,Seizure disorder,Neurological,All ages,Affects ~1% population,Unknown,Chronic/Recurrent,Seizures; confusion,EEG,Medication,Moderate
Multiple Sclerosis,MS,Neurological,Young Adults,More common in females,Autoimmune,Chronic,Vision loss; weakness,MRI brain/spine,Mixed,Moderate
Parkinson's Disease,,Neurological,Elderly,Affects ~1% >60y,Degeneration,Chronic,Tremor; rigidity,Clinical,Mixed,Moderate
Alzheimer's Disease,,Neurological,Elderly,Most common dementia,Degeneration,Chronic,Memory loss; confusion,Clinical; MRI,Supportive care,High
Meningitis,,Infectious Disease,All ages,Common in unvaccinated,Infection,Acute,Fever; neck stiffness,Lumbar puncture,Medication,High
Encephalitis,,Infectious Disease,All ages,Often viral,Inflammation,Acute,Fever; confusion,MRI; CSF,Supportive care,High
Herpes Zoster,Shingles,Infectious Disease,Adults/Elderly,Reactivation of varicella-zoster virus,Unknown,Acute,Painful vesicular rash,Clinical,Antivirals,Mixed
Cellulitis,,Infectious Disease,All ages,Common after skin break,Infection,Acute,Red; warm,Clinical,Medication,Low
Psoriasis,,Dermatology,All ages,Affects 2-3% population,Inflammation,Chronic,Scaly plaques on extensor surfaces,Clinical,Mixed,Low
Eczema,Atopic dermatitis,Dermatology,Children,Common in atopic families,Unknown,Chronic,Itchy; dry patches,Clinical,Mixed,Low
Acne Vulgaris,Acne,Dermatology,Teens/Young Adults,Very common,Unknown,Chronic/Recurrent,Pimples; blackheads,Clinical,Mixed,Low
Melanoma,,Dermatology,Adults,Common in fair skin,Unknown,Chronic,Irregular pigmented lesion,Biopsy,Mixed,High
Basal Cell Carcinoma,BCC,Dermatology,Adults,Most common skin cancer,Unknown,Chronic,Pearly papule,Biopsy,Mixed,Low
Squamous Cell Carcinoma,SCC,Dermatology,Adults,Sun-exposed areas,Unknown,Chronic,Scaly ulcerated nodule,Biopsy,Mixed,Moderate
Rheumatoid Arthritis,RA,Rheumatology,Adults,Affects ~1% population,Inflammation,Chronic,Symmetrical joint pain; morning stiffness,RF; anti-CCP,Mixed,Moderate
Osteoarthritis,,Rheumatology,Elderly,Most common arthritis,Degeneration,Chronic,Joint pain worse with use,X-ray,Mixed,Low
Gout,,Rheumatology,Adults,More common in males,Unknown,Acute/Recurrent,Painful swollen joint,Uric acid levels; joint aspiration,Mixed,Low
Systemic Lupus Erythematosus,SLE,Rheumatology,Young Women,Autoimmune connective tissue disease,Unknown,Chronic,Malar rash; arthritis; fatigue,ANA; anti-dsDNA,Immunosuppressants,Mixed
Anemia (Iron Deficiency),,Hematology,All ages,Common worldwide,Unknown,Chronic,Fatigue; pallor,CBC; ferritin,Mixed,Low`;

    const GREEN=0.8, ORANGE=0.4;
    let DATA=[];
    let BY_NAME=new Map();
    let TARGET=null;
    let GUESSED=new Set();
    const RELATEDNESS={
      system:{ 'ent':{'respiratory':0.6}, 'hepatobiliary':{'gastrointestinal':0.7 } },
      etiology:{ 'infectious-bacterial':{'infectious-viral':0.8,'autoimmune':0.2}, 'infectious-viral':{'infectious-bacterial':0.8} },
      management:{ 'antibiotics':{'antivirals':0.7,'supportive':0.3}, 'needle decompression':{'chest tube':0.9} },
      course:{ 'acute':{'subacute':0.6,'chronic':0.2}, 'subacute':{'chronic':0.5} },
      age:{ 'extremes of age':{'neonate (0-28d)':0.8,'older adult (65+)':0.8}, 'child':{'toddler':0.6,'adolescent':0.6}, 'adult':{'young adult (19-39)':0.6,'middle adult (40-64)':0.6} }
    };
    function normalizeToken(s){ return (s||'').toString().trim().toLowerCase(); }
    function splitTags(s){ return (s? s.split(';'):[]).map(t=>normalizeToken(t)).filter(Boolean); }
    function parseCSV(text){
      const lines=text.trim().split('\n').filter(l=>l.trim().length>0);
      const headers=lines[0].split(',').map(h=>h.trim());
      return lines.slice(1).map(line=>{
        const cells=line.split(',');
        const obj={}; headers.forEach((h,i)=>{ obj[h]=cells[i]?cells[i].trim():''; });
        return obj;
      });
    }
    function normalizeRow(r){
      return {
        diagnosis: normalizeToken(r.Diagnosis||r.diagnosis),
        aliases: splitTags(r.Aliases||r.aliases).concat([]),
        system: normalizeToken(r.System||r.system),
        age: splitTags(r.AgeGroup||r.agegroup||r.age),
        epidemiology: splitTags(r.Epidemiology||r.epidemiology),
        etiology: splitTags(r.Etiology||r.etiology),
        findings: splitTags(r.KeyFindings||r.keyfindings||r.findings),
        management: splitTags(r.Management||r.management),
        course: normalizeToken(r.TypicalCourse||r.course||r.typicalcourse)
      };
    }
    function loadDataset(rows){
      DATA = rows.map(normalizeRow).filter(r=>r.diagnosis);
      BY_NAME = new Map();
      DATA.forEach(r=>{
        BY_NAME.set(r.diagnosis, r.diagnosis);
        r.aliases.forEach(a=>BY_NAME.set(a, r.diagnosis));
      });
      const dl=document.getElementById('diagnosisList');
      dl.innerHTML = DATA.map(r=>`<option value="${escapeHtml(title(r.diagnosis))}"></option>`).join('') +
                     DATA.flatMap(r=>r.aliases.map(a=>`<option value="${escapeHtml(title(a))}"></option>`)).join('');
      resetGame();
    }
    function title(s){ return (s||'').split(' ').map(w=> w? (w[0].toUpperCase()+w.slice(1)) : '').join(' '); }
    function escapeHtml(str){ return str.replace(/[&<>"']/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m])); }
    function relScore(domain,a,b){
      a=normalizeToken(a); b=normalizeToken(b);
      if(!a||!b) return 0;
      if(a===b) return 1;
      const m=RELATEDNESS[domain]||{};
      if(m[a]&&m[a][b]!=null) return m[a][b];
      if(m[b]&&m[b][a]!=null) return m[b][a];
      if(domain==='age' && (a==='all ages'||b==='all ages')) return 0.5;
      return 0;
    }
    function jaccard(aSet,bSet){
      if(aSet.length===0 && bSet.length===0) return 1;
      const A=new Set(aSet), B=new Set(bSet);
      let inter=0; A.forEach(x=>{ if(B.has(x)) inter++; });
      const uni=new Set([...A,...B]).size;
      return uni? inter/uni : 0;
    }
    function setRelatedness(domain,aSet,bSet){
      if(aSet.length===0 && bSet.length===0) return 1;
      function bestSum(X,Y){
        if(X.length===0||Y.length===0) return 0;
        let sum=0; X.forEach(x=>{
          let best=0; Y.forEach(y=>{ best=Math.max(best, relScore(domain,x,y)); });
          sum+=best;
        });
        return sum/ X.length;
      }
      const ab=bestSum(aSet,bSet), ba=bestSum(bSet,aSet);
      return (ab+ba)/2;
    }
    function ageSimilarity(aSet,bSet){
      const exact=jaccard(aSet,bSet);
      const rel=setRelatedness('age',aSet,bSet);
      return Math.max(exact, rel);
    }
    function systemSimilarity(a,b){ if(!a&&!b) return 1; if(!a||!b) return 0; if(a===b) return 1; return relScore('system',a,b); }
    function etiologySimilarity(aSet,bSet){ return Math.max(jaccard(aSet,bSet), setRelatedness('etiology',aSet,bSet)); }
    function managementSimilarity(aSet,bSet){ return Math.max(jaccard(aSet,bSet), setRelatedness('management',aSet,bSet)); }
    function courseSimilarity(a,b){ if(!a&&!b) return 1; if(!a||!b) return 0; if(a===b) return 1; return relScore('course',a,b); }
    function colorFor(score){ if(score>=0.8) return 'green'; if(score>=0.4) return 'orange'; return 'red'; }
    function resetGame(){
      GUESSED = new Set();
      document.querySelector('#table tbody').innerHTML='';
      document.getElementById('guess').value='';
    }
    function pickRandom(){ if(DATA.length===0) return; TARGET = DATA[Math.floor(Math.random()*DATA.length)]; }
    function addGuess(input){
      if(!TARGET){ alert('Click Reset Diagnosis to start.'); return; }
      let key=normalizeToken(input); if(!key) return;
      if(BY_NAME.has(key)) key=BY_NAME.get(key);
      const row=DATA.find(r=>r.diagnosis===key);
      if(!row){ alert('Not found. Try another term.'); return; }
      if(GUESSED.has(key)) return;
      GUESSED.add(key);
      renderRow(row);
    }
    function renderRow(guess){
      const t=TARGET;
      const scoreSystem = systemSimilarity(guess.system, t.system);
      const scoreAge = ageSimilarity(guess.age, t.age);
      const scoreEpi = jaccard(guess.epidemiology, t.epidemiology);
      const scoreEti = etiologySimilarity(guess.etiology, t.etiology);
      const scoreFind = jaccard(guess.findings, t.findings);
      const scoreMgmt = managementSimilarity(guess.management, t.management);
      const scoreCourse = courseSimilarity(guess.course, t.course);
      const mean = avg([scoreSystem,scoreAge,scoreEpi,scoreEti,scoreFind,scoreMgmt,scoreCourse]);
      const tr=document.createElement('tr');
      tr.innerHTML = `
        <td><strong>${escapeHtml(title(guess.diagnosis))}</strong></td>
        ${colorCell(scoreSystem, disp([guess.system]))}
        ${colorCell(scoreAge, disp(guess.age))}
        ${colorCell(scoreEpi, disp(guess.epidemiology))}
        ${colorCell(scoreEti, disp(guess.etiology))}
        ${colorCell(scoreFind, disp(guess.findings))}
        ${colorCell(scoreMgmt, disp(guess.management))}
        ${colorCell(scoreCourse, disp([guess.course]))}
        <td class="score">${(mean*100).toFixed(0)}%</td>`;
      document.querySelector('#table tbody').appendChild(tr);
      if([scoreSystem,scoreAge,scoreEpi,scoreEti,scoreFind,scoreMgmt,scoreCourse].every(s=>s>=0.8)){
        setTimeout(()=>alert('üéâ Correct! You found the diagnosis.'), 50);
      }
    }
    function colorCell(score, html){
      const cls=colorFor(score);
      const pct=(score*100).toFixed(0);
      return `<td title="Similarity ${pct}%"><span class="cell ${cls}">${html}</span></td>`;
    }
    function avg(xs){ return xs.reduce((a,b)=>a+b,0)/xs.length; }
    function disp(arr){ if(!arr||arr.length===0) return '<span class="muted">‚Äî</span>'; return arr.map(x=>`<span class="chip">${escapeHtml(title(x))}</span>`).join(' '); }
    const guessInput=document.getElementById('guess');
    const guessBtn=document.getElementById('guessBtn');
    function submitGuess(){ addGuess(guessInput.value); guessInput.value=''; guessInput.focus(); }
    guessBtn.addEventListener('click', submitGuess);
    guessInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); submitGuess(); }});
    document.getElementById('resetBtn').addEventListener('click', ()=>{ pickRandom(); resetGame(); });
    const toggleBtn = document.getElementById('toggleInstructions');
    const panel = document.getElementById('instructionsPanel');
    if (toggleBtn && panel) {
      toggleBtn.addEventListener('click', () => {
        const isOpen = toggleBtn.getAttribute('aria-expanded') === 'true';
        toggleBtn.setAttribute('aria-expanded', String(!isOpen));
        if (!isOpen) {
          panel.hidden = false;
          panel.classList.add('is-open');
          toggleBtn.innerHTML = 'Hide Instructions <span class="toggle-icon" aria-hidden="true">‚ñ≤</span>';
        } else {
          panel.classList.remove('is-open');
          panel.hidden = true;
          toggleBtn.innerHTML = 'Show Instructions <span class="toggle-icon" aria-hidden="true">‚ñº</span>';
        }
      });
    }
    const rows = parseCSV(CSV_30);
    loadDataset(rows);
    pickRandom();
    (function(){
      const el = document.getElementById('organConfetti');
      if (!el) return;
      const icons = ['ü´Ä','ü´Å','üß†','ü©∫','üß¨'];
      const count = 20;
      for (let i=0; i<count; i++){
        const span = document.createElement('span');
        span.className = 'bit';
        span.textContent = icons[i % icons.length];
        const x = Math.random()*100;
        const y = Math.random()*100;
        const scale = 0.9 + Math.random()*0.6;
        span.style.left = x+'vw';
        span.style.top  = y+'vh';
        span.style.transform = `translate(-50%,-50%) scale(${scale})`;
        el.appendChild(span);
      }
    })();
  </script>
</body>
</html>
