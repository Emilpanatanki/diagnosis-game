<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Guess the Diagnosis...ðŸ¤”</title>
  <style>
    button{transition:transform .12s ease, box-shadow .12s ease;}
    button:hover{transform:translateY(-1px); box-shadow:0 6px 16px rgba(10,20,60,.08);}
    :root{
      --bg:#f7faff; --panel:#ffffff; --ink:#0b1220; --muted:#4b5565;
      --green:#15a377; --amber:#eab308; --orange:#b7791f; --red:#d64545; --accent:#2563eb;
      --chip:#f3f6fb; --chip-b:#e5eaf3; --border:#e6e9f2;
    }
    html,body{
      background:var(--bg);
      color:var(--ink);
      font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      margin:0
    }
    .wrap{max-width:1100px; margin:24px auto; padding:0 16px}
    h1{font-size:24px; margin:0 0 12px}
    .card{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:16px;
      padding:16px;
      box-shadow:0 6px 18px rgba(10,20,60,.05)
    }
    .row{display:flex; gap:12px; flex-wrap:wrap}
    .row > *{flex:1}
    label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    input[type="text"]{
      width:100%;
      background:#ffffff;
      color:var(--ink);
      border:1px solid #dce1eb;
      border-radius:10px;
      padding:10px 12px
    }
    button{
      background:var(--accent);
      color:#ffffff;
      border:0;
      border-radius:12px;
      padding:10px 14px;
      font-weight:600;
      cursor:pointer
    }
    button:disabled{opacity:.5; cursor:not-allowed}
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      background:var(--chip);
      border:1px solid var(--chip-b);
      padding:6px 10px;
      border-radius:999px;
      font-size:12px;
      display:inline-block;
      margin:6px 8px 6px 0
    }
    .chip.green{ background:rgba(21,163,119,.14); border-color:rgba(21,163,119,.35); }
    .chip.amber{ background:rgba(234,179,8,.18); border-color:rgba(234,179,8,.45); }
    .chip.orange{ background:rgba(183,121,31,.16); border-color:rgba(183,121,31,.42); }
    .chip.red{ background:rgba(214,69,69,.16); border-color:rgba(214,69,69,.42); }
    table{width:100%; border-collapse:separate; border-spacing:0; margin-top:12px}
    thead th{position:sticky; top:0; background:#f4f7ff; z-index:2}
    th, td{
      border-bottom:1px solid var(--border);
      padding:10px;
      text-align:left;
      vertical-align:top;
      font-size:14px
    }
    tbody tr:hover{background:#f9fbff}
    .score{font-weight:700}
    .legend{
      display:flex;
      gap:12px;
      align-items:center;
      color:var(--muted);
      font-size:13px;
      flex-wrap:wrap
    }
    .swatch{
      width:14px;
      height:14px;
      border-radius:4px;
      display:inline-block;
      margin-right:6px
    }
    .swatch.g{background:var(--green)}
    .swatch.y{background:var(--amber)}
    .swatch.o{background:var(--orange)}
    .swatch.r{background:var(--red)}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .colwrap{overflow:auto}
    .rightShift{ margin-left: 8px }

    .progress-bar{
      margin-top:8px;
      width:100%;
      max-width:260px;
      height:8px;
      border-radius:999px;
      background:#e5eaf3;
      overflow:hidden;
    }
    .progress-inner{
      height:100%;
      width:0;
      border-radius:999px;
      background:var(--accent);
      transition:width .2s ease;
    }

    /* Solved modal */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:50;
    }
    .overlay.is-open{ display:flex; }
    .modal{
      background:#ffffff;
      padding:20px 24px;
      border-radius:18px;
      max-width:320px;
      width:90%;
      text-align:center;
      box-shadow:0 18px 40px rgba(15,23,42,0.25);
    }
    .modal h2{
      margin:0 0 8px;
      font-size:18px;
    }
    .modal p{
      margin:4px 0;
      font-size:14px;
      color:var(--muted);
    }
    .modal button{
      margin-top:12px;
      width:100%;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Guess the Diagnosis...ðŸ¤”</h1>

    <!-- Daily vignette card -->
    <div id="vignetteCard" class="card" style="margin-top:16px">
      <div class="small muted">Today's case</div>
      <p id="vignetteText" style="margin:8px 0 0 0"></p>
    </div>

    <div class="card" style="margin-top:16px">
      <div class="row">
        <div>
          <label for="guess">Your Guess</label>
          <input id="guess" list="diagnosisList" type="text" placeholder="Start typing a diagnosisâ€¦" />
          <datalist id="diagnosisList"></datalist>
        </div>
        <div style="align-self:end; display:flex; gap:8px">
          <button id="guessBtn" class="rightShift">Add Diagnosis</button>
        </div>
      </div>

      <div id="statusMsg" class="small muted" style="margin-top:8px"></div>

      <div class="progress-bar" role="progressbar" aria-label="Best similarity so far" aria-valuemin="0" aria-valuemax="100">
        <div id="progressInner" class="progress-inner" aria-valuenow="0"></div>
      </div>

      <div class="legend" style="margin-top:10px">
        <span><span class="swatch g"></span>Green = exact/very close</span>
        <span><span class="swatch y"></span>Yellow = close near-miss</span>
        <span><span class="swatch o"></span>Orange = far near-miss</span>
        <span><span class="swatch r"></span>Red = different</span>
      </div>
      <div class="colwrap">
        <table id="table">
          <thead>
            <tr>
              <th>Guess</th>
              <th>System</th>
              <th>Age group</th>
              <th>Epidemiology</th>
              <th>Etiology</th>
              <th>Key findings</th>
              <th>Management</th>
              <th>Course</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <p class="small muted" style="margin-top:10px">Educational use only. Not medical advice.</p>
  </div>

  <!-- Solved popup -->
  <div id="solvedOverlay" class="overlay" role="dialog" aria-modal="true" aria-labelledby="solvedTitle">
    <div class="modal">
      <h2 id="solvedTitle">ðŸŽ‰ Correct!</h2>
      <p id="solvedText"></p>
      <p class="small muted">Come back tomorrow for a new case.</p>
      <button id="closeSolvedBtn">Close</button>
    </div>
  </div>

  <script>
  (function(){
    const CSV_30 = `Diagnosis,Aliases,System,AgeGroup,Epidemiology,Etiology,Onset,KeyFindings,Investigation,Management,SeverityRisk
Myocardial Infarction,Heart attack; MI,cardiovascular,older adult (65+),older male; smoker; atherosclerosis; diabetes,vascular; thrombotic,acute,chest pain; dyspnea; diaphoresis,ecg; troponin,antiplatelets; anticoagulation; reperfusion therapy,high
Pneumonia,Lower respiratory tract infection,respiratory,older adult (65+),older adult; winter season; aspiration risk,infection,acute,fever; cough; dyspnea; sputum,cxr,antibiotics; supportive care,moderate
Asthma,Bronchial asthma,respiratory,child,child; atopy; family history,inflammatory,acute; recurrent; episodic,wheeze; cough; dyspnea,spirometry,bronchodilators; inhaled steroids,low
Stroke,Cerebrovascular accident; CVA,neurology,older adult (65+),older adult; hypertension; atrial fibrillation,vascular; thrombotic,acute,weakness focal; facial droop; confusion,ct; mri,reperfusion therapy; antiplatelets; anticoagulation,high
Appendicitis,,gastrointestinal,young adult,young adult; appendiceal obstruction,obstructive; infection,acute,rlq pain; fever; nausea vomiting,clinical; ultrasound,surgery (appendectomy),moderate
Diabetic Ketoacidosis,DKA,endocrine,adolescent,type 1 diabetes; insulin omission; infection,metabolic,acute,polyuria; polydipsia; dehydration; nausea vomiting,blood glucose; ketones; abg,iv fluids; insulin; electrolyte replacement,high
Cholelithiasis,Gallstones,gastrointestinal,middle adult,female; obesity; fatty meals; pregnancy,obstructive,variable,ruq pain; nausea,ultrasound,analgesia; elective cholecystectomy,low
Tuberculosis,TB,respiratory,young adult,close contact; high-prevalence setting,infection,chronic,cough; weight loss; night sweats; fever,sputum smear; cxr,antituberculous therapy,moderate
Hypertension,High blood pressure,cardiovascular,middle adult,family history; obesity; high salt intake,genetic; idiopathic,chronic,headache; often asymptomatic,bp measurement,lifestyle changes; antihypertensive drugs,moderate
Chronic Obstructive Pulmonary Disease,COPD,respiratory,older adult (65+),chronic smoker; occupational exposure,inflammatory; obstructive,chronic,dyspnea; cough; sputum,spirometry,bronchodilators; inhaled steroids; smoking cessation,moderate
Gastroesophageal Reflux Disease,GERD,gastrointestinal,middle adult,obesity; late meals; hiatal hernia,functional,chronic,heartburn; regurgitation; chest pain,ph monitoring; endoscopy,ppi therapy; lifestyle changes,low
Migraine,,neurology,young adult,female; family history,idiopathic,recurrent; episodic,headache; photophobia; nausea vomiting,clinical,analgesics; migraine prophylaxis,low
Depression,Major depressive disorder,psychiatry,young adult,prior episode; psychosocial stressors,idiopathic; genetic,chronic; episodic,low mood; anhedonia; fatigue,clinical,antidepressants; psychotherapy,moderate
Anxiety Disorder,Generalized anxiety disorder,psychiatry,young adult,stressful life events; chronic worry,idiopathic,chronic,restlessness; insomnia; fatigue,clinical,anxiolytics; psychotherapy,low
Bipolar Disorder,Manic depression,psychiatry,young adult,family history; mood episodes,idiopathic; genetic,episodic,mood swings; decreased sleep need,clinical,mood stabilizers; antipsychotics,moderate
Peptic Ulcer Disease,PUD,gastrointestinal,middle adult,nsaid use; h pylori infection,infection,chronic; recurrent,epigastric pain; nausea,endoscopy,ppi therapy; h pylori eradication,low
Viral Hepatitis B,Hep B,gastrointestinal,young adult,unvaccinated; blood or sexual exposure,infection,acute; chronic,jaundice; fatigue; nausea,hbsag; lfts,antiviral therapy; supportive care,moderate
Viral Hepatitis C,Hep C,gastrointestinal,middle adult,iv drug use; past transfusion,infection,chronic,fatigue; often asymptomatic,hcv antibody; hcv rna,direct-acting antivirals,moderate
HIV/AIDS,Human immunodeficiency virus infection,immunology,young adult,unprotected sex; iv drug use,infection,chronic,weight loss; fever; opportunistic infections,hiv ab/ag; hiv rna,antiretroviral therapy; prophylaxis for opportunistic infections,high
Sepsis,Septicemia,immunology,older adult (65+),hospitalized patient; invasive devices,infection,acute,fever; hypotension; tachycardia,blood cultures; lactate,iv antibiotics; iv fluids; vasopressors,high
Urinary Tract Infection,UTI,genitourinary,young adult,sexually active female; prior uti,infection,acute,dysuria; frequency; suprapubic pain,urinalysis; urine culture,oral antibiotics; analgesia,low
Pyelonephritis,,genitourinary,young adult,female; ascending urinary infection,infection,acute,fever; flank pain; nausea vomiting,urinalysis; urine culture,iv or oral antibiotics; fluids,moderate
Nephrolithiasis,Kidney stones,genitourinary,young adult,dehydration; prior stones,metabolic; obstructive,acute; recurrent,flank pain; hematuria,ct,analgesia; hydration; stone removal if needed,moderate
Chronic Kidney Disease,CKD,genitourinary,older adult (65+),long-standing diabetes; long-standing hypertension,metabolic,chronic,fatigue; edema; pruritus,egfr; creatinine; urine acr,bp control; dialysis; nephroprotective drugs,high
Otitis Media,,ent,infant,daycare; recent upper respiratory infection,infection,acute,ear pain; fever; irritability,otoscopy,analgesia; antibiotics when indicated,low
Otitis Externa,Swimmer's ear,ent,adolescent,swimmer; local trauma,infection,acute,ear pain; discharge,otoscopy,topical antibiotics; ear drops,low
Sinusitis,Rhinosinusitis,ent,young adult,after upper respiratory infection; allergic rhinitis,infection,acute,facial pain; nasal congestion; headache,clinical,intranasal steroids; decongestants; Â±antibiotics,low
Tonsillitis,Pharyngitis,ent,adolescent,winter; close contact,infection,acute,sore throat; fever; dysphagia,throat swab,analgesia; antibiotics when bacterial,low
Conjunctivitis,Pink eye,ophthalmology,young adult,contact with infected person; viral or bacterial,infection,acute,red eye; eye discharge,clinical,topical antibiotics or supportive care,low
Glaucoma,,ophthalmology,older adult (65+),elevated intraocular pressure; family history,degenerative,chronic,peripheral vision loss; headache,tonometry,pressure-lowering eye drops; surgery when needed,moderate
Cataract,,ophthalmology,older adult (65+),age-related lens changes,degenerative,chronic,blurred vision; glare,slit-lamp exam,cataract surgery,low
Retinal Detachment,,ophthalmology,middle adult,myopia; eye trauma; prior ocular surgery,degenerative,acute,flashes; floaters; peripheral vision loss,fundoscopy,urgent retinal surgery,high
Epilepsy,Seizure disorder,neurology,young adult,idiopathic; prior brain injury,idiopathic,chronic; recurrent,seizure; postictal confusion,eeg,antiepileptic drugs,moderate
Multiple Sclerosis,MS,neurology,young adult,young woman; temperate climate,autoimmune,chronic,vision blur; focal weakness; numbness,mri; csf,disease-modifying therapy; relapse steroids,moderate
Parkinson's Disease,,neurology,older adult (65+),older male; idiopathic,degenerative,chronic,tremor; rigidity; bradykinesia,clinical,dopaminergic therapy; supportive care,moderate
Alzheimer's Disease,,neurology,older adult (65+),advanced age; family history,degenerative,chronic,memory loss; confusion,clinical; neuropsych,cognitive enhancers; supportive care,high
Meningitis,,neurology,child,unvaccinated; close living conditions,infection,acute,fever; neck stiffness; headache,lp,iv antibiotics; supportive care,high
Encephalitis,,neurology,young adult,viral infection; seasonal exposure,infection; inflammatory,acute,fever; confusion; seizure,mri; csf,antivirals when indicated; supportive care,high
Herpes Zoster,Shingles,dermatology,older adult (65+),reactivation of varicella; older age,infection,acute,vesicular rash; dermatomal pain,clinical,antivirals; analgesia,mixed
Cellulitis,,dermatology,middle adult,skin break; chronic edema,infection,acute,fever; erythema; warmth,clinical,systemic antibiotics; limb elevation,low
Psoriasis,,dermatology,young adult,family history; chronic inflammatory skin disease,inflammatory,chronic,scaly plaques; pruritus,clinical,topical steroids; immunomodulators,low
Eczema,Atopic dermatitis,dermatology,infant,atopy; family history,inflammatory,chronic,pruritus; dry patches,clinical,emollients; topical steroids,low
Acne Vulgaris,Acne,dermatology,adolescent,puberty; increased sebum,inflammatory,chronic; recurrent,papules; pustules; comedones,clinical,topical retinoids; antibiotics; skin hygiene,low
Melanoma,,dermatology,middle adult,fair skin; intense sun exposure,neoplastic,chronic,irregular lesion; color change,biopsy,surgical excision; oncology referral,high
Basal Cell Carcinoma,BCC,dermatology,older adult (65+),chronic sun exposure,neoplastic,chronic,pearly papule; ulcer,biopsy,local excision; destructive therapy,low
Squamous Cell Carcinoma,SCC,dermatology,older adult (65+),sun exposure; immunosuppression,neoplastic,chronic,ulcerated nodule; scale,biopsy,surgical excision; radiotherapy when needed,moderate
Rheumatoid Arthritis,RA,rheumatology,middle adult,young to middle-aged woman; autoimmune,autoimmune,chronic,arthralgia; joint swelling; morning stiffness,rf; anti-ccp; esr/crp,dmards; nsaids; steroids,moderate
Osteoarthritis,,rheumatology,older adult (65+),age; joint overuse; obesity,degenerative,chronic,arthralgia; worse with use; brief stiffness,x-ray,analgesia; physiotherapy; joint replacement,low
Gout,,rheumatology,middle adult,middle-aged man; hyperuricemia; alcohol,metabolic,acute; recurrent,joint swelling; severe pain (1st mtp),uric acid; joint aspiration,nsaids; colchicine; urate-lowering therapy,low
Systemic Lupus Erythematosus,SLE,rheumatology,young adult,young woman; autoimmune; multi-system,autoimmune,chronic,malar rash; arthralgia; fatigue,ana; anti-dsdna,immunosuppressants; steroids,mixed
Anemia (Iron Deficiency),,hematology,young adult,menorrhagia; low dietary iron; chronic blood loss,deficiency,chronic,fatigue; pallor; dyspnea on exertion,cbc; ferritin,oral iron; treat underlying cause,low`;

    // Abstract strict vignettes
    const VIGNETTES = {
      'myocardial infarction': 'A 60 year old male presents with chest pain.',
      'pneumonia': 'A 72 year old female presents with fever and cough.',
      'asthma': 'A 16 year old male presents with shortness of breath.',
      'stroke': 'A 71 year old female presents with sudden weakness on one side.',
      'appendicitis': 'A 21 year old male presents with stomach pain.',
      'diabetic ketoacidosis': 'A 19 year old female presents feeling very unwell.',
      'cholelithiasis': 'A 42 year old female presents with upper stomach pain.',
      'tuberculosis': 'A 28 year old female presents with a long-l
